# NewsCast Auto-Generator 最終詳細要件定義書
## 1. システムアーキテクチャ
本システムは、日本の主要ニュースをYahoo! RSSから自動収集し、英語学習者（B1レベル）向けの4〜5分の対話型ポッドキャストYoutube動画生成システムです。
完全自動のデータ収集と、ユーザーによる記事選択UI機能を提供します。

データ収集: Python + GitHub Actions (Cron)
データベース: Firebase Firestore
管理UI: Next.js (Vercel)
生成エンジン: Gemini API (Flash/Pro) + Google Search Grounding
音声合成: Gemini Native Audio Output (Multi-speaker TTS)
音声編集: FFmpeg (Python Wrapper)

## 2. データ収集・蓄積要件（Backend / Worker）

データソース: Yahoo! ニュース RSS（以下の7カテゴリ）
主要、国内、国際、経済、エンタメ、スポーツ、IT

自動化: GitHub Actions による1時間に1回の定期実行（Cron）。
重複排除ロジック: 記事URLのハッシュ値をドキュメントIDとして使用。Firestoreへの `set`（merge: true）により、完全に重複を排除。
保存データ: `category`, `title`, `link`, `summary`, `pub_date`, `created_at`, `status(unread/selected/archived)`。

## 3. データベース要件（Persistence）

プラットフォーム: Google Cloud Firestore (Native Mode)。
ドキュメント構成: `news` コレクションに全記事をフラットに格納。
インデックス: `created_at`（降順）でのクエリを最適化。

## 4. データ層・ステート管理 (Firestore)
### 4.1 記事ドキュメント仕様
ID: hashlib.md5(article_url.encode()).hexdigest() （重複排除のキー）
フィールド:
title: string (日本語)
link: string (元記事URL)
category: string (主要/国内/国際/経済/エンタメ/スポーツ/IT)
pub_date: timestamp
status: unread (初期値) | selected (ユーザー選択) | archived (生成完了)
selected_at: timestamp (Stale監視用)

### 4.2 ライフサイクルロジック
収集: 1時間ごとにRSSから新着を取得し、IDが衝突しないもののみ unread で保存。
動画作成: JST2:15にselected な記事を３つ取得してスクリプト作成から動画作成してYoutubeにUploadする、選んだ記事はarchived に更新。

## 5. スクリプト生成ロジック (Script Engineering)
### 5.1 コンテンツ制約
ターゲット: 英語学習者 (B1レベル / 中高生語彙)。
総尺: 4分 〜 5分。
単語数目標: 500∼650 words。
話者構成:
Steve: 解説役。冷静で知識豊富。
Nancy: 聞き手。明るく、視聴者の疑問を代弁する。

### 5.2 対話フロー構造 (1セクションあたり)
Introduction: ニュースタイトルの平易な英語翻訳と提示。
Vocabulary Hook: 用語を1つ抽出。「What does [word] mean?」のやり取りを必須とする。
Deep Dive: GeminiのSearch Groundingを用いた、記事URLの背景情報・詳細の解説（3〜4往復）。
Discussion: そのニュースが日本や生活にどう影響するか、二人の意見を交わす。

## 6. 音声生成・編集ロジック (Audio Engineering)
### 6.1 音声構成ファイル
intro_fixed.mp3: (固定ファイル) 番組挨拶。BGM(Main)込み。末尾は「それではニュースです」等の定型句。
dynamic_main.mp3: (Gemini生成) ニュース3項目 ＋ アウトロ。

### 6.2 Gemini API 音声生成仕様
マルチスピーカー: 1つのリクエストでSteveとNancyを交互に発話させ、1つのバイナリで出力。
エモーション制御: JSONの emotion タグ（neutral, curious, surprised, empathetic）をプロンプトに注入し、モデルの表現力を引き出す。

### 6.3 FFmpegによる自動ミキシングロジック
dynamic_main.mp3 を終了までループ再生。

## 7. Web UI 機能要件 (Next.js)
Dashboard: unread の記事をカテゴリ別に一覧表示。
Selection: 記事を選択可能。
Execution: ボタン押下で選ばれた記事の status を selected、selected_at を ServerTimestamp に更新。
全て選択、全解除、チェックボックスを入れたデータの一括削除ボタン。

## 8. 技術スタック・インフラ
レイヤー	技術 / サービス
Backend	Python 3.11+, Firebase Admin SDK
Frontend	Next.js 14+ (App Router), Firebase Client SDK
AI (LLM/TTS)	Gemini 2.5/3 Pro (for complex script), Flash (for audio)
Infrastructure	GitHub Actions, Vercel, Firebase Firestore
Media Processing	FFmpeg-python

